<template name="Problems">

    <div>
        {{#if NoPatientSelected}}
            <!-- this panel shows nothing if no patient is selected -->
        {{else}}
        <div>
            <div class="pull-right">
                Select Program: <select class="metric-select">
                {{#each program in metricPrograms}}
                    <option id="p-{{program}}">{{program}}</option>
                {{/each}}
            </select>
            </div>
            <h4>Problems Summary</h4>
            <div class="shrinkWrap">
            {{#if Diabetes}}
                <strong>Diabetes</strong>
            <br/>
                Matching diagnosis:
                <span class="hintText" data-toggle="tooltip" title="updated {{Diabetes.[0].date}}">
                    {{Diabetes.[0].name}} - {{Diabetes.[0].ProblemCode}}
                </span>
                <br/>
                A1c history:

                    {{#each lab in A1cList}}
                        <span class="btn-xs cursor-default" style="background: {{colorValueHighBad lab.value lab.refLow lab.refHigh}}" data-toggle="tooltip" title="{{lab.date}}">
                        {{lab.value}}{{lab.unit}}
                        </span>
                        &nbsp;

                    {{/each}}
                <br/>
                {{> metricTable metricCategory="Diabetes"}}
            {{/if}}
            {{#if HeartFailure}}
                Systolic Heart Failure Recommendations
            {{/if}}
            {{#if Hypertension}}
                Hypertension Recommendations
            {{/if}}
            {{#if HeartDisease}}
                Coronary Artery Disease Recommendations
            {{/if}}

            General Health Maintenance Recommendations
            </div>
        </div>

        <div>
            <a style="visibility: {{visibility}}" class="aaa-dev-tools" data-toggle="collapse" href="#obsVomitDiv">Raw data</a>
            <div id="obsVomitDiv" class="collapse">
                <pre class="pre-scrollable">
                    {{obsVomit}}
                </pre>
            </div>
        </div>
        {{/if}}
    </div>

</template>

<template name="metricTable">
    <ul>
        {{#each metric in metricsRed}}
            <li>

                <a class="plainLink" data-toggle="collapse" href="#{{metric._id}}">{{metric.name}} - {{metric.statusReason}}</a>
                {{#if metric.observationId}}
                    <ul>
                        <li class="collapse" id="{{metric._id}}">
                            last {{obsName metric.observationId}}: {{obsDate metric.observationId}}
                        </li>
                    </ul>
                {{/if}}
            </li>
        {{/each}}
    </ul>
</template>